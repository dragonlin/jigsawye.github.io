<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Redux 起手式：Actions、Reducers 及 Store · JIGSAWYE</title><meta name="description" content="Redux 起手式：Actions、Reducers 及 Store - Evan Ye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><meta name="description" content="真正開始寫 React 大概是這一兩個月的時間吧，印象中前幾個月正火紅的時候，觀望著開發架構，從 Facebook 剛開始的 Flux，一路看到 fluxxor、alt 這些 Library 等等，真的是多到爆，然後那個 Flux 的概念圖看了不下 N 次，但還是不得其門而入。
直到不久前出現了一個叫 Redux 的東西，剛好有新 project 要用 React 寫，看著各方大神推薦就順勢跳進">
<meta property="og:type" content="profile">
<meta property="og:title" content="Redux 起手式：Actions、Reducers 及 Store">
<meta property="og:url" content="http://jigsawye.com/2015/11/29/instruction-with-redux/index.html">
<meta property="og:site_name" content="JIGSAWYE">
<meta property="og:description" content="真正開始寫 React 大概是這一兩個月的時間吧，印象中前幾個月正火紅的時候，觀望著開發架構，從 Facebook 剛開始的 Flux，一路看到 fluxxor、alt 這些 Library 等等，真的是多到爆，然後那個 Flux 的概念圖看了不下 N 次，但還是不得其門而入。
直到不久前出現了一個叫 Redux 的東西，剛好有新 project 要用 React 寫，看著各方大神推薦就順勢跳進">
<meta property="og:updated_time" content="2015-11-30T18:05:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redux 起手式：Actions、Reducers 及 Store">
<meta name="twitter:description" content="真正開始寫 React 大概是這一兩個月的時間吧，印象中前幾個月正火紅的時候，觀望著開發架構，從 Facebook 剛開始的 Flux，一路看到 fluxxor、alt 這些 Library 等等，真的是多到爆，然後那個 Flux 的概念圖看了不下 N 次，但還是不得其門而入。
直到不久前出現了一個叫 Redux 的東西，剛好有新 project 要用 React 寫，看著各方大神推薦就順勢跳進">
<meta property="fb:app_id" content="495983917226031"><meta property="og:image" content="https://avatars1.githubusercontent.com/u/8567270?v=3&amp;s=300"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"><link rel="search" type="application/opensearchdescription+xml" href="http://jigsawye.com/atom.xml" title="JIGSAWYE"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/jigsawye" target="_self" class="nav-list-link"><i alt="Github" title="Github" class="fa fa-github"></i></a></li><li class="nav-list-item"><a href="https://facebook.com/jigsaw.ye" target="_self" class="nav-list-link"><i alt="Facebook" title="Facebook" class="fa fa-facebook"></i></a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link"><i alt="RSS" title="RSS" class="fa fa-rss"></i></a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Redux 起手式：Actions、Reducers 及 Store</h1><div class="post-info">2015年11月29日</div><div class="post-content"><p>真正開始寫 <a href="https://facebook.github.io/react/" target="_blank" rel="external">React</a> 大概是這一兩個月的時間吧，印象中前幾個月正火紅的時候，觀望著開發架構，從 Facebook 剛開始的 <a href="https://github.com/facebook/flux" target="_blank" rel="external">Flux</a>，一路看到 <a href="https://github.com/BinaryMuse/fluxxor" target="_blank" rel="external">fluxxor</a>、<a href="https://github.com/goatslacker/alt" target="_blank" rel="external">alt</a> 這些 Library 等等，真的是多到爆，然後那個 Flux 的概念圖看了不下 N 次，但還是不得其門而入。</p>
<p>直到不久前出現了一個叫 <a href="github.com/rackt/redux">Redux</a> 的東西，剛好有新 project 要用 React 寫，看著各方大神推薦就順勢跳進 Redux 的世界了。最近也利用 Redux 寫了個 <a href="https://github.com/jigsawye/node-proxy-manager-client" target="_blank" rel="external">Proxy manager</a>，趁最近期中考完，回頭寫一下 Redux 的核心概念。</p>
<a id="more"></a>
<!-- toc -->
<h2 id="那些在-React-遇到的麻煩事"><a href="#那些在-React-遇到的麻煩事" class="headerlink" title="那些在 React 遇到的麻煩事"></a>那些在 React 遇到的麻煩事</h2><p>你會有個 Root Component，然後它負責：</p>
<ul>
<li>有一株肥美的 state tree（狀態樹）管理下層元件的資料</li>
<li>有一坨負責處理資料的 function 透過 props 傳遞給下層元件呼叫，以改變上面那棵樹</li>
</ul>
<p>所以呢，Facebook 就建議了一種 Flux 架構，把那些 function 及 state tree 給抽出來集中管理。</p>
<h2 id="為什麼選-Redux"><a href="#為什麼選-Redux" class="headerlink" title="為什麼選 Redux"></a>為什麼選 Redux</h2><p>以我來說有這幾個原因：</p>
<ul>
<li>概念很簡單，只要清楚 Actions 及 Reducer 就可以開始實做了</li>
<li>API 很少，而且只是幾個單純的 function，還有很方便的 Middleware 可以用</li>
<li>有完善的 devtools，可回溯的 state</li>
<li>社群資源多，而且我觀察台灣大多數 React 開發者都選用 Redux</li>
<li>官方文件有中文版（<a href="http://chentsulin.github.io/redux/" target="_blank" rel="external">由此去</a>），而且有完整的 step by step example</li>
</ul>
<h2 id="所以那個流程"><a href="#所以那個流程" class="headerlink" title="所以那個流程"></a>所以那個流程</h2><p>我以很常見的 counter（計數器）為例，假設我要將目前的數字 + 1：</p>
<ul>
<li>dispatch（發送）一個 increment（+ 1）的 Action（動作）</li>
<li>管理 counter 的 reducer 接收到 action 後將 state 中目前的數字 + 1</li>
<li>state tree 及 reducers 由 store 集中管理，並由 React 取用</li>
</ul>
<h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><p>就以剛剛的 Todo 為例，actions 基本上就只是一個 JavaScript 物件，只需要定義好這個 action 的 type（類型）即可，當這個 action 被 dispatch 時，這個物件就會被傳至 reudcer，所以若有資料需要傳入，只需要加在這個 action 物件中：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  type: <span class="string">'INCREMENT'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一般來說會向下方這樣把 type 定義成常數做取用，不過這邊就盡量精簡化了：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> INCREMENT = <span class="string">'INCREMENT'</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h3><p>reducer 則是一個 function，負責接收被 dispatch 的 action 並處理 state，要注意的是需傳入兩個參數到這個 function，第一個是目前的 state，第二個則是我們定義的 action 物件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">state = 0, action</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 在這邊回傳處理好的 state</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>就是這麼簡單的 function，要注意的是，初始化的時候 state 是空的，所以在第一個參數放了預設的 state。<br>接著就是撰寫處理 state 的部分：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">state = 0, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">    <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>還記得在 action 定義的 type 吧？我們會在 reducer 中根據 action 物件中的 type 去對應要執行的動作，接著回傳處理完的 state。</p>
<h3 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h3><p>我們現在知道了定義的 action 及處理 state 的 reducer，最後我們則需要透過 redux 的 <code>createStore</code> 將 reducer 轉換成 store：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="comment">// 如果透過瀏覽器的方式執行的話可以寫成下面這樣</span></span><br><span class="line"><span class="comment">// const &#123; createStore &#125; = Redux;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 產生 store</span></span><br><span class="line"><span class="keyword">let</span> store = createStore(counter);</span><br></pre></td></tr></table></figure></p>
<p>對，就這麼一行，接著你就可以開始透過 action 操作 state 了：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 透過 getState() 取得目前的 state</span></span><br><span class="line"><span class="built_in">console</span>.log(store.getState());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 透過 dispatch() 發送我們剛剛所定義的 action</span></span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: <span class="string">'INCREMENT'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 看執行後的 state</span></span><br><span class="line"><span class="built_in">console</span>.log(store.getState());</span><br></pre></td></tr></table></figure></p>
<h2 id="Done"><a href="#Done" class="headerlink" title="Done!"></a>Done!</h2><p>想像一下，Redux 就是個超級狀態機，藉由我們定義的 action 去改變 state。而我們只用了 Redux 提供的 <code>createStore()</code> 產生 store，API 相當簡單。上面的程式我放在 <a href="http://jsbin.com/conezo/edit?js,console" target="_blank" rel="external">jsbin</a> 上，點右上角的 run 即可看執行的結果。搞懂基本概念後，接著可以去查看<a href="http://rackt.org/redux/docs/basics/Actions.html" target="_blank" rel="external">官方文件的 Todo Example</a>，或是 Redux 的 Creator <a href="https://github.com/gaearon" target="_blank" rel="external">Dan Abramov</a> 在 egghead 上的<a href="https://egghead.io/lessons/javascript-redux-the-single-immutable-state-tree?series=getting-started-with-redux" target="_blank" rel="external">影片教學</a>。</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="http://rackt.org/redux/" target="_blank" rel="external">http://rackt.org/redux/</a></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/2015/11/30/running-react-native-on-device/" class="prev">上一篇</a><a href="/2015/11/23/enable-emmet-for-jsx-in-sublime/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'jigsawnotes';
var disqus_identifier = '2015/11/29/instruction-with-redux/';
var disqus_title = 'Redux 起手式：Actions、Reducers 及 Store';
var disqus_url = 'http://jigsawye.com/2015/11/29/instruction-with-redux/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//jigsawnotes.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://jigsawye.com">Evan Ye</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-57230871-3",'auto');ga('send','pageview');</script></body></html>