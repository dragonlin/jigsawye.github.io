<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>在 Laravel 使用 Route Model Binding · JIGSAWYE</title><meta name="description" content="在 Laravel 使用 Route Model Binding - Evan Ye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><meta name="description" content="本文適用於 Laravel 5.0 以上版本。

什麼是 Route Model Binding？
Laravel model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user’s ID, you can in">
<meta property="og:type" content="profile">
<meta property="og:title" content="在 Laravel 使用 Route Model Binding">
<meta property="og:url" content="http://jigsawye.com/2015/07/23/use-route-model-binding-in-laravel/index.html">
<meta property="og:site_name" content="JIGSAWYE">
<meta property="og:description" content="本文適用於 Laravel 5.0 以上版本。

什麼是 Route Model Binding？
Laravel model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user’s ID, you can in">
<meta property="og:updated_time" content="2016-02-04T06:11:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在 Laravel 使用 Route Model Binding">
<meta name="twitter:description" content="本文適用於 Laravel 5.0 以上版本。

什麼是 Route Model Binding？
Laravel model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user’s ID, you can in">
<meta property="fb:app_id" content="495983917226031"><meta property="og:image" content="https://avatars1.githubusercontent.com/u/8567270?v=3&amp;s=300"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/jigsawye" target="_self" class="nav-list-link"><i alt="Github" title="Github" class="fa fa-github"></i></a></li><li class="nav-list-item"><a href="https://facebook.com/jigsaw.ye" target="_self" class="nav-list-link"><i alt="Facebook" title="Facebook" class="fa fa-facebook"></i></a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link"><i alt="RSS" title="RSS" class="fa fa-rss"></i></a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">在 Laravel 使用 Route Model Binding</h1><div class="post-info">2015年7月23日</div><div class="post-content"><blockquote>
<p>本文適用於 Laravel 5.0 以上版本。</p>
</blockquote>
<h2 id="什麼是-Route-Model-Binding？"><a href="#什麼是-Route-Model-Binding？" class="headerlink" title="什麼是 Route Model Binding？"></a>什麼是 Route Model Binding？</h2><blockquote>
<p>Laravel model binding provides a convenient way to inject class instances into your routes. For example, instead of injecting a user’s ID, you can inject the entire User class instance that matches the given ID.<br>(<a href="http://laravel.com/docs/5.0/routing#route-model-binding" target="_blank" rel="external">http://laravel.com/docs/5.0/routing#route-model-binding</a>)</p>
</blockquote>
<a id="more"></a>
<p>中文版：</p>
<blockquote>
<p>Laravel 模型綁定提供方便的方式將模型實例注入到你的路由中。例如，比起注入 User 的 ID ，你可以選擇注入符合給定 ID 的 User 類別實例。<br>(<a href="http://laravel.tw/docs/5.0/routing#route-model-binding" target="_blank" rel="external">http://laravel.tw/docs/5.0/routing#route-model-binding</a>)</p>
</blockquote>
<p>文字敘述不懂沒關係，更快的方式就是舉個例子，假設我們有一個 Resource Route 及對應的 Resource Controller：<br><figure class="highlight php"><figcaption><span>route.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::resource(<span class="string">'articles'</span>, <span class="string">'ArticlesController'</span>);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight php"><figcaption><span>ArticlesController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticlesController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="comment">// 省略七個標準 RESTful method</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一般來說，在 <code>show</code> method 裡我們通常會這樣實作：<br><figure class="highlight php"><figcaption><span>ArticlesController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($id)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    $article = Article::find($id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'articles.show'</span>, compact(<span class="string">'article'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是只要透過 Route Model Binding，我們的程式碼就可以改成這樣：<br><figure class="highlight php"><figcaption><span>ArticlesController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Article $article)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'articles.show'</span>, compact(<span class="string">'article'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>對於我這種超懶的開發者很受用，少寫一行算一行，幫助開發更快速。</p>
<h2 id="設定-Route-Model-Binding"><a href="#設定-Route-Model-Binding" class="headerlink" title="設定 Route Model Binding"></a>設定 Route Model Binding</h2><h4 id="綁定-Model"><a href="#綁定-Model" class="headerlink" title="綁定 Model"></a>綁定 Model</h4><p>一般來說都會將綁定設定在 <code>RouteServiceProvider</code> （App/Provider/RouteServiceProvider.php）中，在這裡我用上述的範例做綁定：<br><figure class="highlight php"><figcaption><span>RouteServiceProvider.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(Router $router)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::boot($router);</span><br><span class="line"></span><br><span class="line">    $router-&gt;bind(<span class="string">'articles'</span>, <span class="string">'App\Article'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接著在我們的 method 直接使用 type-hine 注入 Model，就可以直接存取 <code>$article</code> 了：<br><figure class="highlight php"><figcaption><span>ArticleController.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Article $article)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'article.show'</span>, compact(<span class="string">'article'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>也就是說，如果 Request 是 <code>/articles/7</code>，那麼 <code>$article</code> 就會是 <code>Article::findOrFail(7)</code>，若該筆資料不存在則會拋出 404。</p>
<h2 id="綁定做了什麼？"><a href="#綁定做了什麼？" class="headerlink" title="綁定做了什麼？"></a>綁定做了什麼？</h2><p>那麼 <code>bind</code> 做了什麼事呢？讓我們看一下 Route list：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+-----------+---------------------------+------------------+----------------------------+</span><br><span class="line">| Method    | URI                       | Name             | Action                     |</span><br><span class="line">+-----------+---------------------------+------------------+----------------------------+</span><br><span class="line">| GET|HEAD  | articles                  | articles.index   | ArticlesController@index   |</span><br><span class="line">| GET|HEAD  | articles/create           | articles.create  | ArticlesController@create  |</span><br><span class="line">| POST      | articles                  | articles.store   | ArticlesController@store   |</span><br><span class="line">| GET|HEAD  | articles/&#123;articles&#125;       | articles.show    | ArticlesController@show    |</span><br><span class="line">| GET|HEAD  | articles/&#123;articles&#125;/edit  | articles.edit    | ArticlesController@edit    |</span><br><span class="line">| PUT       | articles/&#123;articles&#125;       | articles.update  | ArticlesController@update  |</span><br><span class="line">| PATCH     | articles/&#123;articles&#125;       | articles         | ArticlesController@update  |</span><br><span class="line">| DELETE    | articles/&#123;articles&#125;       | articles.destroy | ArticlesController@destroy |</span><br><span class="line">+-----------+---------------------------+------------------+----------------------------+</span><br></pre></td></tr></table></figure></p>
<p>注意到有 <code>{articles}</code> 的 Route，這邊的變數 <code>articles</code> 也就是我們在 <code>bind()</code>傳入的第一個參數，Route Model Binding 會自動在你綁定的 Model（第二個參數 <code>\App\Article</code>） 搜尋（<code>findOrFail</code>）主鍵為 <code>{articles}</code> 的資料。所以不只在 <code>show</code> method，只要任何有 <code>{articles}</code> 的 Route 都會自動做綁定，相當的方便（懶人）。</p>
<h2 id="自定搜尋條件"><a href="#自定搜尋條件" class="headerlink" title="自定搜尋條件"></a>自定搜尋條件</h2><p>有些情況並不適用於預設的 <code>Model::findOrFail($id)</code>，例如只希望找出已經發佈的 Article，這時候可以改變 <code>bind()</code> 的第二個參數為包含自訂搜尋的條件的 Closure：<br><figure class="highlight php"><figcaption><span>RouteServiceProvider.php</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">(Router $router)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">parent</span>::boot($router);</span><br><span class="line"></span><br><span class="line">    $router-&gt;bind(<span class="string">'articles'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> \App\Article::where(<span class="string">'published_at'</span>, <span class="string">'&lt;='</span>, Carbon::now())-&gt;findOrFail($id);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到此你已經瞭解如何運用 Route Model Binding 囉！未來如果搭上 Form Model binding 在開發上會更加的快速（懶人）！</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/09/25/gitlab-ce-in-docker/" class="prev">上一篇</a><a href="/2015/06/22/using-pjax-with-laravel-5/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'jigsawnotes';
var disqus_identifier = '2015/07/23/use-route-model-binding-in-laravel/';
var disqus_title = '在 Laravel 使用 Route Model Binding';
var disqus_url = 'http://jigsawye.com/2015/07/23/use-route-model-binding-in-laravel/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//jigsawnotes.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://jigsawye.com">Evan Ye</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-57230871-3",'auto');ga('send','pageview');</script></body></html>